<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Äiá»ƒm danh GPS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    #result {
      margin-top: 15px;
      white-space: pre-line;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>ğŸ“ Äiá»ƒm danh GPS</h2>

<input type="text" id="studentName" placeholder="Nháº­p há» vÃ  tÃªn">

<button onclick="checkIn()">ğŸ“ Láº¥y vá»‹ trÃ­ & Äiá»ƒm danh</button>

<div id="result"></div>

<script>
/* ================== Cáº¤U HÃŒNH ================== */

// ğŸ‘‰ TOáº  Äá»˜ Lá»šP (Sá»¬A)
const CLASS_LAT = 16.461231;
const CLASS_LNG = 107.601894;

// ğŸ‘‰ BÃN KÃNH CHO PHÃ‰P (m)
const ALLOW_RADIUS = 30;

// ğŸ‘‰ GIá»œ ÄIá»‚M DANH (Sá»¬A Má»–I BUá»”I)
const START_HOUR = 2;
const START_MIN  = 0;

const END_HOUR   = 7;
const END_MIN    = 15;

// ğŸ‘‰ CHá»NG ÄIá»‚M DANH Láº I
const STORAGE_KEY = "checked_in";

/* ============================================== */

function isWithinTime() {
  const now = new Date();
  const nowMin = now.getHours() * 60 + now.getMinutes();
  const startMin = START_HOUR * 60 + START_MIN;
  const endMin = END_HOUR * 60 + END_MIN;
  return nowMin >= startMin && nowMin <= endMin;
}

function checkIn() {
  const name = document.getElementById("studentName").value.trim();
  const result = document.getElementById("result");

  if (name === "") {
    result.textContent = "âŒ Vui lÃ²ng nháº­p há» vÃ  tÃªn";
    return;
  }

  if (!isWithinTime()) {
    result.textContent = "â›” NgoÃ i thá»i gian Ä‘iá»ƒm danh";
    return;
  }

  if (localStorage.getItem(STORAGE_KEY)) {
    result.textContent = "âš ï¸ Báº¡n Ä‘Ã£ Ä‘iá»ƒm danh rá»“i";
    return;
  }

  if (!navigator.geolocation) {
    result.textContent = "âŒ TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ GPS";
    return;
  }

  result.textContent = "â³ Äang láº¥y vá»‹ trÃ­...";

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const accuracy = pos.coords.accuracy;

      const distance = getDistance(lat, lng, CLASS_LAT, CLASS_LNG);

      const now = new Date();
      const timeString = now.toLocaleString("vi-VN");

      let output = "";
      output += `ğŸ‘¤ Há» tÃªn: ${name}\n`;
      output += `ğŸ“… Thá»i gian: ${timeString}\n`;
      output += `ğŸ“ Khoáº£ng cÃ¡ch: ${distance.toFixed(1)} m\n`;
      output += `ğŸ¯ Accuracy: ${accuracy.toFixed(1)} m\n`;

      if (distance <= ALLOW_RADIUS) {
        output += "âœ… ÄIá»‚M DANH THÃ€NH CÃ”NG";
        localStorage.setItem(STORAGE_KEY, "true");
      } else {
        output += "âŒ Báº¡n khÃ´ng á»Ÿ trong khu vá»±c lá»›p";
      }

      result.textContent = output;
    },
    () => {
        result.textContent = "âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c vá»‹ trÃ­ (chÆ°a báº­t GPS?)";
    },
    {
      enableHighAccuracy: true,
      timeout: 10000
    }
  );
}

/* ===== TÃNH KHOáº¢NG CÃCH GPS ===== */
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const toRad = deg => deg * Math.PI / 180;

  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);

  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(toRad(lat1)) *
    Math.cos(toRad(lat2)) *
    Math.sin(dLon / 2) ** 2;

  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}
</script>

</body>
</html>