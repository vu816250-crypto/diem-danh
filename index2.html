<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒêi·ªÉm danh GPS</title>
</head>

<body>

<button onclick="getLocation()">üìç L·∫•y v·ªã tr√≠ & ƒêi·ªÉm danh</button>
<pre id="log">Ch∆∞a b·∫•m</pre>

<script>
/* ===== C·∫§U H√åNH ===== */
const CLASS_LAT = 16.461000;
const CLASS_LNG = 107.602000;
const MAX_DISTANCE = 30; // m√©t

const START_TIME = new Date("2026-01-23T02:02:00");
const END_TIME   = new Date("2026-01-23T07:10:00");

/* ===== H√ÄM PH·ª§ ===== */
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

function checkTime() {
    const now = new Date();
    return now >= START_TIME && now <= END_TIME;
}

/* ===== H√ÄM CH√çNH ===== */
function getLocation() {
    const log = document.getElementById("log");

    if (!checkTime()) {
        log.textContent = "‚õî H·∫øt th·ªùi gian ƒëi·ªÉm danh";
        return;
    }

    if (localStorage.getItem("checked")) {
        log.textContent = "‚ö†Ô∏è M√°y n√†y ƒë√£ ƒëi·ªÉm danh r·ªìi";
        return;
    }

    log.textContent = "‚è≥ ƒêang y√™u c·∫ßu v·ªã tr√≠...\n";

    if (!navigator.geolocation) {
        log.textContent += "‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS";
        return;
    }

    navigator.geolocation.getCurrentPosition(
        function (pos) {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            const acc = pos.coords.accuracy;

            const distance = getDistance(lat, lng, CLASS_LAT, CLASS_LNG);

            log.textContent += "üìç Kho·∫£ng c√°ch: " + distance.toFixed(1) + " m\n";
            log.textContent += "üéØ Accuracy: " + acc + " m\n";

            if (acc > 30) {
                log.textContent += "‚ùå GPS kh√¥ng ƒë·ªß ch√≠nh x√°c\n";
                return;
            }

            if (distance > MAX_DISTANCE) {
                log.textContent += "‚ùå Ngo√†i ph·∫°m vi l·ªõp h·ªçc\n";
                return;
            }

            log.textContent += "‚úÖ ƒêI·ªÇM DANH TH√ÄNH C√îNG";
            localStorage.setItem("checked", "yes");
        },
        function (err) {
            log.textContent += "‚ùå L·ªói GPS\n";
            log.textContent += err.message;
        },
        {
            enableHighAccuracy: true,
            timeout: 20000,
            maximumAge: 0
        }
    );
}
</script>

</body>
</html>